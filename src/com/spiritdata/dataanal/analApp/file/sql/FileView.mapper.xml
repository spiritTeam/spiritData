<?xml version="1.0" encoding="UTF-8" ?>
<!--
  文件：对照关系表(主表)
-->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fileView">
  <!-- 对象定义:元数据列模式 -->
  <resultMap id="FileViewMap" type="FileView">
    <id     column="id"          property="fileIndexId" jdbcType="VARCHAR"/>
    <result column="ownerType"   property="ownerType"   jdbcType="INTEGER"/>
    <result column="ownerId"     property="ownerId"     jdbcType="VARCHAR"/>
    <result column="fileSize"    property="fileSize"    jdbcType="INTEGER"/>
    <result column="descn"       property="descn"        jdbcType="VARCHAR"/>
    <result column="cTime"       property="createTime"  jdbcType="TIMESTAMP"/>
    <result column="extInfo"     property="clientFileName"   jdbcType="VARCHAR"/>
    <result column="reportId"     property="reportId"   jdbcType="VARCHAR"/>
    <result column="fileCategoryId" property="fileCategoryId" jdbcType="VARCHAR"/>
  </resultMap>
  <!-- 所有列 -->
  <sql id="Base_Column_List">
    a.id, a.ownerType, a.ownerId, a.fileSize, a.descn, a.cTime, b.extInfo,b.id fileCategoryId
  </sql>
  <!-- 条件子句 -->
  <sql id="WhereClauseByEntiey">
    <where>
      <trim prefix="(" suffix=")" prefixOverrides="and">
        <if test="id!=null"> and id=#{id,jdbcType=VARCHAR}</if>
        <if test="ownerType!=null and ownerType!=0"> and ownerType=#{ownerType,jdbcType=INTEGER}</if>
        <if test="ownerId!=null"> and ownerId=#{ownerId,jdbcType=VARCHAR}</if>
        <if test="fileSize!=null"> and fileSize=#{fileSize,jdbcType=INTEGER}</if>
        <if test="descn!=null"> and descn=#{descn,jdbcType=VARCHAR}</if>
        <if test="createTime!=null"> and cTime=#{cTime,jdbcType=TIMESTAMP}</if>
      </trim>
    </where>
  </sql>

  <!-- 获得查询结果列表 -->
  <select id="getFileList" resultMap="FileViewMap" parameterType="java.util.Map">
    select <include refid="Base_Column_List"/> 
    from (sa_file_index a JOIN sa_file_category b)
    <where>
      <trim prefix="(" suffix=")" prefixOverrides="and">
        <if test="1==1">a.id=b.fid and b.type1='IMP'</if>
        <if test="ownerId!=null"> and ownerId = #{ownerId,jdbcType=VARCHAR},</if>
        <if test="ownerType!=null and ownerType!=0"> and ownerType=#{ownerType,jdbcType=INTEGER}</if>
        <if test="startTime!=null"> <![CDATA[and cTime>= #{startTime,jdbcType=TIMESTAMP}]]>,</if>
        <if test="endTime!=null"> <![CDATA[and cTime < #{endTime,jdbcType=TIMESTAMP}]]>,</if>
        <if test="cFileName!=null"> and extInfo like %#{cFileName,jdbcType=VARCHAR}%,</if>
      </trim>
    </where>     
    order by a.cTime desc
  </select>
  
  <!-- 获得查询结果列表 -->
  <select id="getFileList2" resultMap="FileViewMap" parameterType="java.util.Map">
    select <include refid="Base_Column_List"/> 
    from (sa_file_index a JOIN sa_file_category b LEFT JOIN sa_file_rel c LEFT JOIN sa_report_info d)
    <where>
      <trim prefix="(" suffix=")" prefixOverrides="and">
        <if test="1==1">a.id=b.fid and b.type1='IMP' and (b.id=c.aId and c.aType='2' and c.bType='2' and c.rType2='即时报告')</if>
        <if test="ownerId!=null"> and ownerId = #{ownerId,jdbcType=VARCHAR},</if>
        <if test="ownerId!=null"> and ownerId = #{ownerId,jdbcType=VARCHAR},</if>
        <if test="startTime!=null"> <![CDATA[and cTime>= #{startTime,jdbcType=TIMESTAMP}]]>,</if>
        <if test="endTime!=null"> <![CDATA[and cTime < #{endTime,jdbcType=TIMESTAMP}]]>,</if>
        <if test="cFileName!=null"> and extInfo like %#{cFileName,jdbcType=VARCHAR}%,</if>
      </trim>
    </where>     
    order by a.cTime desc
  </select>
</mapper>